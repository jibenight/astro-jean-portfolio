---
import Close from './Close.astro';
import heroVideo from '../assets/video/code.mp4';
const iconBasePath = '/icons-dev/';
const yearsExperience = Math.max(0, new Date().getFullYear() - 2017);

const softSkills = [
  'Communication claire',
  'Leadership',
  'Résolution de problèmes',
  'Empathie client',
  'Gestion du temps',
  'Esprit critique',
  'Autonomie',
  'Collaboration',
];

const hardHighlights = [
  'Architecture front-end',
  'Design system maintenable',
  'Performance web (Core Web Vitals)',
  'Accessibilité niveau AA',
  'Automatisation CI/CD',
  'Optimisation SEO technique',
];

const techSkills = [
  { label: 'HTML / CSS', icon: 'html5.svg', level: 95 },
  { label: 'JavaScript', icon: 'js.svg', level: 90 },
  { label: 'React', icon: 'react.svg', level: 85 },
  { label: 'Astro', icon: 'astro.svg', level: 90 },
  { label: 'Node.js', icon: 'nodejs.svg', level: 75 },
  { label: 'Git & CI', icon: 'github.svg', level: 88 },
  { label: 'WordPress', icon: 'wordpress.svg', level: 92 },
  { label: 'Linux/Bash', icon: 'linux.svg', level: 70 },
];

const aiTools = [
  {
    name: 'Claude, Gemini, ChatGPT',
    tag: 'Prompt engineering',
    desc: 'idéation & revue de specs',
  },
  {
    name: 'Codex',
    tag: 'Pair coding',
    desc: 'accélération dev front',
  },
  {
    name: 'Nano Banana pro',
    tag: 'Moodboards',
    desc: 'recherches visuelles rapides',
  },
  {
    name: 'Make / n8n',
    tag: 'Automation',
    desc: 'pipelines et QA automatisés',
  },
];

const metrics = [
  { value: `${yearsExperience}+`, label: "années d'expérience" },
  { value: '60+', label: 'projets livrés' },
  { value: 'Astro / TW', label: 'stack cœur' },
  { value: '4.6 / 5', label: 'satisfaction clients' },
];
---

<section id='skills' class='skills-section'>
  <Close onClick="closeSection('skills')" />
  <div class='container-title'>
    <div class='title'>
      <h2>Mes compétences</h2>
      <p>Skillset</p>
    </div>
  </div>

  <div class='skills-hero reveal'>
    <div>
      <p class='eyebrow'>Front-end Astro/Tailwind + IA (Claude/ChatGPT/Gemini)</p>
      <h3>Stack moderne, perfs web et IA pour livrer vite et bien.</h3>
      <p>
        Intégration, perfs Core Web Vitals, accessibilité et automatisation :
        l’IA m’aide à analyser, prototyper et QA plus vite, sans lâcher la
        qualité ni la maintenabilité.
      </p>
    </div>
    <div class='hero-icon' aria-hidden='true'>
      <video class='hero-video' src={heroVideo} autoplay muted loop playsinline
      ></video>
    </div>
  </div>

  <div class='skills-grid'>
    <article class='card soft-card reveal'>
      <div class='card-header'>
        <h3>Dimension humaine</h3>
        <div
          class='skill-toggle'
          role='group'
          aria-label='Filtrer les aptitudes'
        >
          <button class='toggle-btn active' data-scope='soft'>Soft</button>
          <button class='toggle-btn' data-scope='hard'>Hard</button>
        </div>
      </div>

      <ul class='badge-list toggle-list soft active'>
        {softSkills.map(skill => <li>{skill}</li>)}
      </ul>
      <ul class='badge-list toggle-list hard'>
        {hardHighlights.map(skill => <li>{skill}</li>)}
      </ul>
    </article>

    <article class='card kpi-card reveal'>
      <h3>Impact en chiffres</h3>
      <div class='metrics'>
        {
          metrics.map(item => (
            <div class='metric-item'>
              <span class='metric-value'>{item.value}</span>
              <span class='metric-label'>{item.label}</span>
            </div>
          ))
        }
      </div>
    </article>

    <article class='card tech-card reveal'>
      <h3>Stack technique</h3>
      <div class='skill-pills'>
        {
          techSkills.map(skill => (
            <div class='pill'>
              <div class='pill-info'>
                <img
                  src={`${iconBasePath}${skill.icon}`}
                  alt={`Icône ${skill.label}`}
                  width='40'
                  height='40'
                />
                <span>{skill.label}</span>
              </div>
              <div class='progress'>
                <span style={`width: ${skill.level}%;`} />
              </div>
            </div>
          ))
        }
      </div>
    </article>

    <article class='card ai-card reveal'>
      <h3>IA & automatisation</h3>
      <p>
        L’IA accompagne chaque phase : prototypage, développement, QA et
        surveillance de production. Elle agit comme un multiplicateur
        d’efficacité, pas un remplacement.
      </p>
      <ul class='ai-tools'>
        {
          aiTools.map(tool => (
            <li>
              <div>
                <strong>{tool.name}</strong>
                <span>{tool.tag}</span>
              </div>
              <p>{tool.desc}</p>
            </li>
          ))
        }
      </ul>
    </article>
  </div>

  <div class='cta-wrap reveal'>
    <div class='cta-text'>
      <p class='eyebrow'>Prendre contact</p>
      <h3>Prêt pour un audit express ou un kick-off ?</h3>
      <p>
        Partagez vos objectifs produit, j’arrive avec un plan d’action concret
        (stack, UX, perfs, automatisations).
      </p>
    </div>
    <button
      class='btn-primary popup-trigger'
      type='button'
      data-open-popup='call-popup'
      aria-haspopup='dialog'
    >
      Prendre contact
    </button>
  </div>
</section>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButtons = document.querySelectorAll('.toggle-btn');
    const lists = document.querySelectorAll('.toggle-list');

    toggleButtons.forEach(button => {
      button.addEventListener('click', () => {
        const scope = button.dataset.scope;
        toggleButtons.forEach(btn =>
          btn.classList.toggle('active', btn === button)
        );
        lists.forEach(list => {
          list.classList.toggle('active', list.classList.contains(scope));
        });
      });
    });

    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.3 }
    );

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
  });
</script>

<style>
  #skills {
    position: fixed;
    inset: 0;
    overflow-y: auto;
    padding: 2rem clamp(1rem, 5vw, 4rem);
    background: #f5f7fb;
  }

  .skills-hero {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 2.4rem;
    padding: 2.5rem;
    border-radius: 32px;
    background: linear-gradient(120deg, #0d8ae8, #1da5fe);
    color: #fff;
    position: relative;
    overflow: hidden;
  }

  .skills-hero .eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.2rem;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    opacity: 0.8;
  }

  .skills-hero h3 {
    font-size: clamp(1.6rem, 2.5vw, 2.4rem);
    margin: 0 0 1rem;
  }

  .hero-icon {
    justify-self: end;
  }

  .hero-icon .hero-video {
    width: 180px;
    height: 180px;
    border-radius: 24px;
    object-fit: cover;
    box-shadow: 0 20px 35px rgba(0, 0, 0, 0.22);
    animation: float 7s ease-in-out infinite;
  }

  @media (max-width: 768px) {
    .skills-hero {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .hero-icon {
      justify-self: center;
    }
  }

  .skills-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
  }

  .card {
    background: #fff;
    border-radius: 24px;
    padding: 1.5rem 2rem;
    box-shadow: 0 20px 45px rgba(0, 0, 0, 0.08);
    transition:
      transform 0.35s ease,
      box-shadow 0.35s ease;
    position: relative;
  }

  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.12);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
  }

  .skill-toggle {
    background: #ecf5ff;
    border-radius: 999px;
    padding: 0.2rem;
    display: inline-flex;
  }

  .toggle-btn {
    border: none;
    background: transparent;
    color: #0d8ae8;
    padding: 0.4rem 1rem;
    border-radius: 999px;
    font-weight: 600;
    cursor: pointer;
    transition:
      background 0.2s ease,
      color 0.2s ease;
  }

  .toggle-btn.active {
    background: #fff;
    color: #111;
    box-shadow: 0 4px 12px rgba(13, 138, 232, 0.2);
  }

  .badge-list {
    list-style: none;
    margin: 1.5rem 0 0;
    padding: 0;
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.6rem;
    opacity: 0;
    pointer-events: none;
    max-height: 0;
    transition:
      opacity 0.25s ease,
      max-height 0.25s ease;
  }

  .badge-list.active {
    opacity: 1;
    pointer-events: auto;
    max-height: 500px;
  }

  .badge-list li {
    background: rgba(15, 171, 255, 0.12);
    border: 1px solid rgba(15, 171, 255, 0.3);
    color: #0d7cd1;
    border-radius: 999px;
    padding: 0.4rem 0.8rem;
    font-size: 1.1rem;
  }

  .kpi-card {
    overflow: hidden;
    background: linear-gradient(135deg, #0d8ae8 0%, #1da5fe 28%, #f6f9ff 28%);
    color: #0b1221;
    position: relative;
  }

  .kpi-card h3 {
    color: #0b1221;
  }

  .kpi-card::after {
    content: '';
    position: absolute;
    top: -40px;
    right: -40px;
    width: 180px;
    height: 180px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.22);
    filter: blur(8px);
  }

  .metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 0.9rem;
    margin-top: 1.2rem;
  }

  .metric-item {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(13, 138, 232, 0.18);
    border-radius: 18px;
    padding: 0.9rem 1rem;
    box-shadow: 0 18px 36px rgba(0, 0, 0, 0.08);
    backdrop-filter: blur(6px);
    display: grid;
    gap: 0.25rem;
  }

  .metric-value {
    display: block;
    font-size: 2.3rem;
    font-weight: 700;
    color: #0c7fd6;
  }

  .metric-label {
    text-transform: uppercase;
    letter-spacing: 0.1rem;
    font-size: 0.8rem;
    color: #51607a;
  }

  .skill-pills {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }

  .pill {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .pill-info {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    font-weight: 600;
  }

  .pill-info img {
    width: 36px;
    height: 36px;
    transition: transform 0.3s ease;
  }

  .card:hover .pill-info img {
    transform: scale(1.05);
  }

  .progress {
    width: 100%;
    height: 8px;
    background: #ecf5ff;
    border-radius: 999px;
    overflow: hidden;
  }

  .progress span {
    display: block;
    height: 100%;
    border-radius: 999px;
    background: linear-gradient(120deg, #0d8ae8, #1da5fe);
  }

  .ai-card ul {
    list-style: none;
    padding: 0;
    margin: 1.2rem 0 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .ai-card li {
    padding: 1rem;
    border-radius: 16px;
    background: #f4f8ff;
    border: 1px solid rgba(13, 138, 232, 0.2);
  }

  .ai-card strong {
    display: block;
    font-size: 1rem;
  }

  .ai-card span {
    font-size: 0.8rem;
    color: #1da5fe;
    text-transform: uppercase;
    letter-spacing: 0.1rem;
  }

  .ai-card p {
    margin: 0.3rem 0 0;
    color: #4c4c4c;
  }

  .cta-wrap {
    margin-top: 2.5rem;
    padding: 2rem;
    border-radius: 32px;
    background: linear-gradient(120deg, #0d8ae8, #1da5fe);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1.4rem;
    flex-wrap: wrap;
    box-shadow: 0 22px 45px rgba(13, 138, 232, 0.25);
  }

  .cta-text h3 {
    font-size: 1.3rem;
  }

  .cta-text p {
    color: #e8f4ff;
  }

  .cta-wrap .btn-primary {
    background: #fff;
    color: #0d8ae8;
    padding: 1.05rem 1.8rem;
    border-radius: 999px;
    font-weight: 800;
    font-size: 1rem;
    text-decoration: none;
    box-shadow: 0 12px 26px rgba(0, 0, 0, 0.15);
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease;
  }

  .cta-wrap .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 18px 32px rgba(0, 0, 0, 0.2);
  }

  .reveal {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 0.6s ease,
      transform 0.6s ease;
  }

  .reveal.in-view {
    opacity: 1;
    transform: translateY(0);
  }

  @keyframes float {
    0% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
    100% {
      transform: translateY(0);
    }
  }

  @media (max-width: 768px) {
    #skills {
      padding: 1.5rem 1rem 3rem;
    }

    .card {
      padding: 1.5rem;
    }

    .metrics {
      flex-direction: column;
    }
  }
</style>
